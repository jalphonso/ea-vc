groups {
    EVPN-ESI {
        chassis {
            aggregated-devices {
                ethernet {
                    device-count 50;
                }
            }
        }
        interfaces {
            et-0/0/52 {
                description "et-0/0/52: Used for inter-chassis LAG";
                ether-options {
                    802.3ad ae49;
                }
            }
            et-0/0/53 {
                description "et-0/0/53: Used for inter-chassis LAG";
                ether-options {
                    802.3ad ae49;
                }
            }
            et-0/0/54 {
                description "et-0/0/54: Used for inter-chassis LAG";
                ether-options {
                    802.3ad ae49;
                }
            }
            et-0/0/55 {
                description "et-0/0/55: Used for inter-chassis LAG";
                ether-options {
                    802.3ad ae49;
                }
            }
            ae49 {
                description "ae49: Inter-chassis LAG for VC pair";
                aggregated-ether-options {
                    lacp {
                        active;
                    }
                }
                unit 0 {
                    family inet {
                        address 10.255.254.0/31;
                    }
                }
            }
            lo0 {
                unit 0 {
                    family inet {
                        address 10.255.255.0/32;
                    }
                }
            }
        }
        interfaces {
            irb {
                unit <*> {
                    proxy-macip-advertisement;
                }
            }
        }
        policy-options {
            prefix-list LOOPBACK {
                apply-path "interfaces lo0 unit 0 family inet address <*>";
            }
            policy-statement EXPORT_UNDERLAY {
                term LOOPBACK {
                    from {
                        protocol direct;
                        prefix-list LOOPBACK;
                    }
                    then {
                        community add UNDERLAY;
                        accept;
                    }
                }
                term ICL {
                    from {
                        protocol direct;
                        route-filter 10.255.254.0/31 orlonger;
                    }
                    then {
                        community add UNDERLAY;
                        accept;
                    }
                }
                term DEFAULT {
                    then reject;
                }
            }
            policy-statement IMPORT_UNDERLAY {
                term IMPORT {
                    from {
                        protocol bgp;
                        community UNDERLAY;
                    }
                    then accept;
                }
                term DEFAULT {
                    then reject;
                }
            }
            policy-statement EXPORT_OVERLAY {
                term DEFAULT {
                    then {
                        community add OVERLAY;
                        accept;
                    }
                }
            }
            policy-statement IMPORT_OVERLAY {
                term IMPORT {
                    from {
                        protocol bgp;
                        community OVERLAY;
                    }
                    then accept;
                }
            }
            policy-statement PFE-LB {
                term DEFAULT {
                    then {
                        load-balance per-packet;
                    }
                }
            }
            community UNDERLAY members 65535:9999;
            community OVERLAY members 65535:9998;
        }
        routing-options {
            router-id 10.255.255.0;
            forwarding-table {
                export PFE-LB;
            }
        }
        protocols {
            lldp {
                interface all;
                interface em0 {
                    disable;
                }
                interface em1 {
                    disable;
                }
            }
        }
        protocols {
            bgp {
                group UNDERLAY {
                    type external;
                    import IMPORT_UNDERLAY;
                    family inet {
                        unicast;
                    }
                    export EXPORT_UNDERLAY;
                    local-as 65535.65500;
                    multipath {
                        multiple-as;
                    }
                    bfd-liveness-detection {
                        minimum-interval 350;
                        multiplier 3;
                    }
                    neighbor 10.255.254.1 {
                        peer-as 65535.65501;
                    }
                }
                group OVERLAY {
                    type internal;
                    local-address 10.255.255.0;
                    import IMPORT_OVERLAY;
                    family evpn {
                        signaling;
                    }
                    export EXPORT_OVERLAY;
                    local-as 65535.64999;
                    multipath;
                    bfd-liveness-detection {
                        minimum-interval 350;
                        multiplier 3;
                        session-mode automatic;
                    }
                    neighbor 10.255.255.1;
                }
            }
            evpn {
                encapsulation vxlan;
                default-gateway no-gateway-community;
                extended-vni-list all;
            }
        }
        switch-options {
            vtep-source-interface lo0.0;
            route-distinguisher 10.255.255.0:1;
            vrf-target {
                target:65535.64999:9999;
                auto;
            }
        }
    }
}
apply-groups EVPN-ESI;
