groups {
    FABRIC_UNDERLAY {
        protocols {
            bgp {
                group UNDERLAY {
                    type external;
                    mtu-discovery;
                    import UNDERLAY_IMPORT;
                    family inet {
                        unicast;
                    }
                    export UNDERLAY_EXPORT;
                    local-as  "4200004002";
                    multipath {
                        multiple-as;
                    }
                    bfd-liveness-detection {
                        minimum-interval 500;
                        multiplier 3;
                        session-mode single-hop;
                    }
                    neighbor 10.1.1.9 {
                        peer-as 4200004010;
                    }
                    neighbor 10.1.1.11 {
                        peer-as 4200004011;
                    }
                }
            }
        }
        policy-options {
            prefix-list LOOPBACK_PRIMARY {
                apply-path "interfaces lo0 unit <*> family inet address <*>";
            }
            policy-statement UNDERLAY_EXPORT {
                term LOOPBACK {
                    from {
                        protocol direct;
                        prefix-list LOOPBACK_PRIMARY;
                    }
                    then {
                        community add UNDERLAY;
                        accept;
                    }
                }
                term BGP {
                    from {
                        protocol bgp;
                        community UNDERLAY;
                    }
                    then accept;
                }
                term DEFAULT {
                    then reject;
                }
            }
            policy-statement UNDERLAY_IMPORT {
                term REJECT_GT_3_AS {
                    from {
                        protocol bgp;
                        as-path LIMIT_3_AS;
                    }
                    then reject;
                }
                term ACCEPT_UNDERLAY {
                    from community UNDERLAY;
                    then accept;
                }
                term DEFAULT {
                    then reject;
                }
            }
            community UNDERLAY members 65400:8578;
            as-path LIMIT_3_AS ".{3, }";
        }

        interfaces {
            et-0/0/0 {
                mtu 9216;
                description "U4010NJ-TCH";
                unit 0 {
                    family inet {
                        address 10.1.1.8/31;
                    }
                }
            }
            et-0/0/1 {
                mtu 9216;
                description "U4011NJ-TCH";
                unit 0 {
                    family inet {
                        address 10.1.1.10/31;
                    }
                }
            }
        }
    }
    FABRIC_OVERLAY {
        protocols {
            bgp {
                group OVERLAY-CLIENT {
                    type internal;
                    mtu-discovery;
                    local-address 10.255.255.102;
                    family evpn {
                        signaling;
                    }
                    vpn-apply-export;
        cluster 0.0.0.1;
                    bfd-liveness-detection {
                        minimum-interval 1000;
                        multiplier 3;
                        session-mode automatic;
                    }
                    multipath;
                    neighbor 10.255.255.110;
                    neighbor 10.255.255.111;
                }

                group OVERLAY-RR {
                    type internal;
                    local-address 10.255.255.102;
                    family evpn {
                        signaling;
                    }
                    vpn-apply-export;
                    bfd-liveness-detection {
                        minimum-interval 1000;
                        multiplier 3;
                        session-mode automatic;
                    }
                    multipath;
                    neighbor 10.255.255.103;
                
                }
            }
            evpn {
                encapsulation vxlan;
                default-gateway no-gateway-community;
                extended-vni-list all;
            }
        }
        policy-options {
            prefix-list IRB_OUT {
                apply-path "interfaces irb unit <*> family inet address <*>";
            }
            policy-statement OVERLAY_CLIENT_IMPORT {
                term IMPORT_EVPN {
                    from {
                        family evpn;
                        community OVERLAY-65400;
                    }
                    then {
                        accept;
                    }
                }
                term DEFAULT {
                    then reject;
                }
            }
            community OVERLAY-65400 members 65400:7986;
        }
        switch-options {
            vtep-source-interface lo0.0;
            route-distinguisher 10.255.255.102:1;
            vrf-target {
                target:65400:9999;
                auto;
            }
        }

        interfaces {
            irb {
                description "IRB";
                unit 2001 {
                    description "VCF Management";
                    family inet {
                        address 172.31.170.2/24 {
                            virtual-gateway-address 172.31.170.1;
                            preferred;
                        }
                    }
                    proxy-macip-advertisement;
                    virtual-gateway-accept-data;
                }
                unit 2002 {
                    description "vMotion";
                    family inet {
                        address 172.31.169.130/25 {
                            virtual-gateway-address 172.31.169.129;
                            preferred;
                        }
                    }
                    proxy-macip-advertisement;
                    virtual-gateway-accept-data;
                }
                unit 2003 {
                    description "vSAN";
                    family inet {
                        address 172.31.171.2/25 {
                            virtual-gateway-address 172.31.171.1;
                            preferred;
                        }
                    }
                    proxy-macip-advertisement;
                    virtual-gateway-accept-data;
                }
                unit 2004 {
                    description "NSX Transport";
                    family inet {
                        address 172.31.171.130/25 {
                            virtual-gateway-address 172.31.171.129;
                            preferred;
                        }
                    }
                    proxy-macip-advertisement;
                    virtual-gateway-accept-data;
                }
                unit 2005 {
                    description "ue900-t0edge-nsx-transport";
                    family inet {
                        address 172.31.172.2/25 {
                            virtual-gateway-address 172.31.172.1;
                            preferred;
                        }
                    }
                    proxy-macip-advertisement;
                    virtual-gateway-accept-data;
                }
            }
        }
        forwarding-options {
            storm-control-profiles default {
                all;
            }
            dhcp-relay {
                maximum-hop-count 16;
                server-group {
                    EA-DHCP-SERVERS {          
                        172.24.26.38;
                        172.24.26.49;
                    }
                }
                group NSX-NETWORKS {
                    active-server-group EA-DHCP-SERVERS;
                    forward-only;
                    interface irb.2001;
                    interface irb.2002;
                    interface irb.2003;
                    interface irb.2004;
                }
            }
           
        }
    }
    MGMT {
        system {

            host-name U4002IJ-TCH;
            root-authentication {
                encrypted-password "$6$mHyfNxFf$7BVK.RQPlobeoOTOrJ5JXz9l0vrSp/5vHrODN.hfqy.kVYjrvtya201p0Qz0WerAVbzRRx3/OVZIS/pxl1SiJ1";
            }
            login {
                message "\n\n\n You are accessing a U.S. Government (USG) Information System (IS) that is\n provided for USG-authorized use only. \n\n By using this IS (which includes any device attached to this IS), you consent\n to the following conditions:\n\n -The USG routinely intercepts and monitors communications on this IS for purposes\n including, but not limited to, penetration testing, COMSEC monitoring, network\n operations and defense, personnel misconduct (PM), law enforcement (LE), and\n counterintelligence (CI) investigations.\n\n -At any time, the USG may inspect and seize data stored on this IS.\n\n -Communications using, or data stored on, this IS are not private, are subject\n to routine monitoring, interception, and search, and may be disclosed or used for\n any USG-authorized purpose.\n\n -This IS includes security measures (e.g., authentication and access controls)\n to protect USG interests--not for your personal benefit or privacy.\n\n -Notwithstanding the above, using this IS does not constitute consent to PM, LE\n or CI investigative searching or monitoring of the content of privileged\n communications, or work product, related to personal representation or services\n by attorneys, psychotherapists, or clergy, and their assistants. Such\n communications and work product are private and confidential. See User Agreement\n for details.\n\n";
                class super-user-local {
                    idle-timeout 360;
                    login-alarms;
                    login-tip;
                    permissions all;
                }
                user stmorim {
                    class super-user;
                    authentication {
                        ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC6oqhW1KdXJLAK7O/76LXOe8pmTSMAq5N+RJF26XrYTDZHH1+TnJJlruY39GSVs0MwQ0aUsCCo0Dgwqm5A0rZp8/jypAi30cPhRqGYbCGmYp4jjA8Riw2mORtJbEhbwZRAB1wbj3VpUzpktswIWUn/7X3hXXZoQ6fQZunizvNxUyoa9G7aUzYPfycbW3LwF51ZHeue5fi6HKylazraGeO+68NJJVpRE1iy7KlBePndxyL3YkrWA0HSz+YTGqVxBWjFsY5bI5XqkgDI4tlTfgfUcE+1QgOyf5LhS5PebaF+iWqhnZlN+RTRAWp6YEkLy31exrz2n8k+MKkzvNjjnjReQOZzetMPm+LeE6v3VSwN/kWVwhalI4sgy7VZulmuMkMKzLpHLXxZRNTHfJJLgDRjrLYBqKvw2tsc6Bi23m5lsdXSfMa6liHbm3dQxTUBloRBQ/qqlHdmTo1GRujx9C764QbiLjocHGy2w+g+Olk/5b0y0um69VlxlxNKGgOqKBM= sara@sara-VirtualBox";
                    }
                }
                user jalphonso {
                    class super-user;
                    authentication {
                        ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6cJBeJmz5INckWhxcsRk7tol83BbcrrzOmwIQSSl7oiNHqiK+/enIPJDJHpMiwx86upHvaV4TuLTD7+WtulZSMHTEDJfmrNoJRWoiOlDEgMcqQbyY2cb10pktIfC4ukzXCXaMm0uX5dchbp+mh0Wa3AyiCN+11yf9Q61gDfQAxTbGjiXiIo4HbW0Myktq6zsx0+PazGA+XVu/m8Nh4/0zb8SiJ59z2Q6RYgUHiO8dZRB7JQSdQpWLkbEIlfyjzB8O/02RHogD28mZ9AGkUPz95O+OudukgWnftZzCLrzhy+iJ6U27EpC3MMymykFIexRA5VEqN2mnSjMkSrGAMA+5 jalphonso@jalphonso-mbp";
                    }
                }
                user remote {
                    class super-user-local
                }
                user greg {
                    class super-user;
                    authentication {
                        ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeaKfDBCRzksH+HItjuf4t/3Z2YRobPqgmscrqWORB/x9BMjS2RN2jv+X8S5qJYWy25cSlpDqEQnfa0+iwrGFml5o8NCQhmcDHcLtNmt9KKUQiIE6VKL1o89JVnzkOEUUox4YANha0OCt/qDMi3fPjgXMcNgR3DubR1q9jL3fmMi73JCu4jRwJifPIk+ZuzTztJoJcPfyzvMoa/IWZdaO4ACbVghSPW957/mMvoAmovKw8xJOo5xmdUN/M8NqHwvpwAfmuB0Zwh7d6MA65hc8bHAR8+Q5nruvgBA7k/0rbNW+oBxwhQHHZd0Uml0R0bzO7iHH4Y+dGtgHIKuMiJ2cB gbensimon@gbensimon-mbp";
                    }
                }
            }
            services {
                ssh {
                    root-login allow;
                }
                netconf {
                    ssh;
                }
            }
            syslog {
                user * {
                    any emergency;
                }
                host 192.168.244.12 {
                    any notice;
                    authorization info;
                    match "!(license)|(clear alarm)|(alarm cleared)";
                    source-address 10.2.205.102 ;
                    explicit-priority;
                }
                file messages {
                    any notice;
                    authorization info;
                    match "!(license)";
                }                                   
                file interactive-commands {         
                    interactive-commands any;       
                }                                   
                file default-log-messages {         
                    any any;                        
                    structured-data;                
                }  
            }
            authentication-order [ radius password ];
            radius-server {
                192.168.244.12 {
                    port 1812;
                    secret $9$R4BErKMWx-bsvMDkPQ9CKM8Lxd;
                    source-address 10.2.205.102 ;
                }
            }
            ddos-protection {
                protocols {
                    arp {
                        aggregate {
                            bandwidth 2000;
                        }
                    }
                }
            }
            ntp {
                server 192.168.244.12 ;
                source-address 10.2.205.102 ;
            }
        }
        routing-options {
            static {
                route 0.0.0.0/0 next-hop 10.2.205.6;
            }
            forwarding-table {
                export PFE-LB;
                chained-composite-next-hop {
                    ingress {
                        evpn;
                    }
                }
            }
            autonomous-system 65400;
            router-id 10.255.255.102;
        }
        chassis {
            aggregated-devices {
                ethernet {
                    device-count 100;
                }
            }
        }
        policy-options { 
            policy-statement PFE-LB {
                term DEFAULT {
                    then {
                        load-balance per-packet;
                    }
                }
            }
        }
        protocols {
            lldp {
                interface all;
                port-id-subtype interface-name;
                neighbour-port-info-display port-id;
            }
        }

        interfaces {
            em0 {
                description "Management";
                unit 0 {
                    family inet {
                        address 10.2.205.102/24;
                    }
                }
            }
        }

        interfaces {
            lo0 {
                description "Loopback";
                unit 0 {
                    family inet {
                        address 10.255.255.102/32
                    }
                }
                unit 1 {
                    family inet {
                        address 10.255.255.102/32
                    }
                }
            }
        }
    }
    TO_DISTRO {
        routing-instances {
            OVERLAY_VR {
                instance-type virtual-router;
                routing-options {
                    autonomous-system 65400;
                }
        protocols {
            bgp {
                group DISTRO_UNDERLAY {
                    type external;
                    mtu-discovery;
                    import UNDERLAY_IMPORT;
                    family inet {
                        unicast;
                    }
                    export UNDERLAY_EXPORT;
                    local-as "4200004002";
                    multipath {
                        multiple-as;
                    }
                    bfd-liveness-detection {
                        minimum-interval 500;
                        multiplier 3;
                        session-mode single-hop;
                    }
                    neighbor 10.1.1.0 {
                        peer-as 4200004000;
                    }
                    neighbor 10.1.1.4 {
                        peer-as 4200004001;
                    }
                }
                group DISTRO_CLIENT {
                    type internal;
                    local-address 10.255.255.102;
                    mtu-discovery;
                    family inet {
                        unicast;
                    }
                    export DC_EXPORT;
                    multipath;
                    bfd-liveness-detection {
                        minimum-interval 1000;
                        multiplier 3;
                        session-mode automatic;
                    }
                    neighbor 10.255.255.100;
                    neighbor 10.255.255.101;
                }
            }
        }        interface et-0/0/6;
                interface et-0/0/7;
                interface irb.2001;
                interface irb.2002;
                interface irb.2003;
                interface irb.2004;
                interface irb.2005;
          
                interface lo0.1;
            }
        }
        policy-options {
            prefix-list IRB_OUT {
                apply-path "interfaces irb unit <*> family inet address <*>";
            }
            policy-statement DC_EXPORT {
                term NO_UNDERLAY {
                    from {
                        protocol bgp;
                        community UNDERLAY;
                    }
                    then reject;
                }
                term IF_ROUTES {
                    from {
                        protocol direct;
                        prefix-list IRB_OUT;
                    }
                    then accept;
                }
            }
            community UNDERLAY members 65400:8578;
        }
         

        interfaces {
            et-0/0/6 {
                mtu 9216;
                description "U4000DJ-TCH";
                unit 0 {
                    family inet {
                        address 10.1.1.1/31;
                    }
                }
            }
            et-0/0/7 {
                mtu 9216;
                description "U4001DJ-TCH";
                unit 0 {
                    family inet {
                        address 10.1.1.5/31;
                    }
                }
            }
        }
    }
}
apply-groups [FABRIC_UNDERLAY FABRIC_OVERLAY TO_DISTRO MGMT];

vlans {
    MANAGEMENT {
        description "Management VLAN for NSX-T";
       vlan-id 2001;
        l3-interface irb.2001;
        vxlan {
            vni 102001;
        }
    }
    VMOTION {
        description "vMotion VLAN for NSX-T";
       vlan-id 2002;
        l3-interface irb.2002;
        vxlan {
            vni 102002;
        }
    }
    STORAGE {
        description "Storage VLAN for NSX-T";
       vlan-id 2003;
        l3-interface irb.2003;
        vxlan {
            vni 102003;
        }
    }
    NSX-TRANSPORT {
        description "NSX-TRANSPORT VLAN for NSX-T in Leaf Group 3";
       vlan-id 2004;
        l3-interface irb.2004;
        vxlan {
            vni 102004;
        }
    }
    NSX-TRANSPORT-EDGE {
        description "ue900-t0edge-nsx-transport";
       vlan-id 2005;
        l3-interface irb.2005;
        vxlan {
            vni 102005;
        }
    }
}
